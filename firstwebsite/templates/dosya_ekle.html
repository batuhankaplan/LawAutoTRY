{% extends "layout.html" %}

{% block title %}Dosya Ekle{% endblock %}

{% block content %}
<header>
    <div class="header-left">
        <h1>Dosya Ekle</h1>
    </div>
</header>
<div class="form-container">
    <form method="POST" class="add-file-form">
        <div class="form-group">
            <label for="file-type">Dosya Türü</label>
            <select id="file-type" name="file-type" onchange="updateDepartments()">
                <option value="">Seçiniz</option>
                <option value="hukuk">Hukuk</option>
                <option value="ceza">Ceza</option>
                <option value="icra">İcra</option>
            </select>
        </div>
        <div class="form-group">
            <label for="courthouse">Adliye</label>
            <select id="courthouse" name="courthouse">
                <option value="">Seçiniz</option>
                <!-- Adliye listesi JavaScript ile doldurulacak -->
            </select>
        </div>
        <div class="form-group">
            <label for="department">Birim</label>
            <select id="department" name="department">
                <option value="">Seçiniz</option>
                <!-- Birim listesi JavaScript ile doldurulacak -->
            </select>
        </div>
        <div class="form-group">
            <label for="year">Yıl</label>
            <input type="number" id="year" name="year" required>
        </div>
        <div class="form-group">
            <label for="case-number">Esas No</label>
            <input type="text" id="case-number" name="case-number" required>
        </div>
        <div class="form-group">
            <label for="client-name">Müvekkil Adı</label>
            <input type="text" id="client-name" name="client-name" required>
        </div>
        <div class="form-group">
            <label for="open-date">Açılış Tarihi</label>
            <input type="date" id="open-date" name="open-date" required value="{{ today_date }}">
        </div>
        <button type="submit">Ekle</button>
    </form>
</div>

<script>
const courthouses = [
    "İstanbul Adliyesi (Çağlayan)",
    "İstanbul Anadolu Adliyesi (Kartal)",
    "Bakırköy Adliyesi",
    "Büyükçekmece Adliyesi",
    "Gaziosmanpaşa Adliyesi",
    "Küçükçekmece Adliyesi",
    "Silivri Adliyesi",
    "Çatalca Adliyesi",
    "Üsküdar Adliyesi",
    "Adalar Adliyesi",
    "Sarıyer Adliyesi",
    "Afşin Adliyesi",
    "Ağrı Adliyesi",
    "Aksaray Adliyesi",
    "Alanya Adliyesi",
    "Amasya Adliyesi",
    "Ankara Adliyesi",
    "Antalya Adliyesi",
    "Ardahan Adliyesi",
    "Artvin Adliyesi",
    "Aydın Adliyesi",
    "Ayvalık Adliyesi",
    "Balıkesir Adliyesi",
    "Bartın Adliyesi",
    "Batman Adliyesi",
    "Bayburt Adliyesi",
    "Bilecik Adliyesi",
    "Bingöl Adliyesi",
    "Bitlis Adliyesi",
    "Bodrum Adliyesi",
    "Bolu Adliyesi",
    "Burdur Adliyesi",
    "Bursa Adliyesi",
    "Çanakkale Adliyesi",
    "Çankırı Adliyesi",
    "Çorum Adliyesi",
    "Denizli Adliyesi",
    "Diyarbakır Adliyesi",
    "Düzce Adliyesi",
    "Edirne Adliyesi",
    "Elazığ Adliyesi",
    "Erzincan Adliyesi",
    "Erzurum Adliyesi",
    "Eskişehir Adliyesi",
    "Fethiye Adliyesi",
    "Gaziantep Adliyesi",
    "Giresun Adliyesi",
    "Gümüşhane Adliyesi",
    "Hakkari Adliyesi",
    "Hatay Adliyesi",
    "Iğdır Adliyesi",
    "Isparta Adliyesi",
    "İzmir Adliyesi",
    "Kahramanmaraş Adliyesi",
    "Karabük Adliyesi",
    "Karaman Adliyesi",
    "Kars Adliyesi",
    "Kastamonu Adliyesi",
    "Kayseri Adliyesi",
    "Kırklareli Adliyesi",
    "Kırıkkale Adliyesi",
    "Kırşehir Adliyesi",
    "Kilis Adliyesi",
    "Konya Adliyesi",
    "Kütahya Adliyesi",
    "Malatya Adliyesi",
    "Manisa Adliyesi",
    "Mardin Adliyesi",
    "Mersin Adliyesi",
    "Muğla Adliyesi",
    "Muş Adliyesi",
    "Nevşehir Adliyesi",
    "Niğde Adliyesi",
    "Ordu Adliyesi",
    "Osmaniye Adliyesi",
    "Rize Adliyesi",
    "Sakarya Adliyesi",
    "Samsun Adliyesi",
    "Şanlıurfa Adliyesi",
    "Siirt Adliyesi",
    "Sinop Adliyesi",
    "Sivas Adliyesi",
    "Şırnak Adliyesi",
    "Tekirdağ Adliyesi",
    "Tokat Adliyesi",
    "Trabzon Adliyesi",
    "Tunceli Adliyesi",
    "Uşak Adliyesi",
    "Van Adliyesi",
    "Yalova Adliyesi",
    "Yozgat Adliyesi",
    "Zonguldak Adliyesi"
];

const departments = {
    hukuk: [
        "Asliye Hukuk Mahkemesi",
        "Sulh Hukuk Mahkemesi",
        "Aile Mahkemesi",
        "İş Mahkemesi",
        "Tüketici Mahkemesi",
        "Kadastro Mahkemesi",
        "Ticaret Mahkemesi",
        "Fikri ve Sınai Haklar Hukuk Mahkemesi",
        "İcra Hukuk Mahkemesi",
        "Tapu ve Kadastro Mahkemesi"
    ],
    ceza: [
        "Asliye Ceza Mahkemesi",
        "Ağır Ceza Mahkemesi",
        "Sulh Ceza Hakimliği",
        "Çocuk Mahkemesi",
        "Çocuk Ağır Ceza Mahkemesi",
        "Fikri ve Sınai Haklar Ceza Mahkemesi",
        "İcra Ceza Mahkemesi",
        "Trafik Mahkemesi",
        "Devlet Güvenlik Mahkemesi",
        "Bölge Adliye Mahkemesi Ceza Daireleri",
        "Yargıtay Ceza Daireleri"
    ],
    icra: Array.from({length: 30}, (_, i) => `${i + 1}. İcra Dairesi`)
};

// Adliye listesini doldur
function populateCourthouses() {
    const select = document.getElementById('courthouse');
    select.innerHTML = '<option value="">Seçiniz</option>';
    courthouses.forEach(courthouse => {
        select.innerHTML += `<option value="${courthouse}">${courthouse}</option>`;
    });
}

// Birim seçildikten sonra mahkeme numarası seçimini göster
function updateDepartments() {
    const fileType = document.getElementById('file-type').value;
    const departmentSelect = document.getElementById('department');
    
    departmentSelect.innerHTML = '<option value="">Seçiniz</option>';
    
    if (fileType && departments[fileType]) {
        departments[fileType].forEach(dept => {
            departmentSelect.innerHTML += `<option value="${dept}">${dept}</option>`;
        });
    }

    // Birim seçimi değiştiğinde mahkeme numarası seçimini güncelle
    departmentSelect.onchange = function() {
        updateCourtNumbers(this.value);
    };
}

// Mahkeme numarası seçimini güncelle
function updateCourtNumbers(department) {
    // İcra dairesi için ayrı işlem yapma
    if (department.includes('İcra Dairesi')) {
        return;
    }

    let courtNumberContainer = document.getElementById('court-number-container');
    if (!courtNumberContainer) {
        courtNumberContainer = document.createElement('div');
        courtNumberContainer.id = 'court-number-container';
        courtNumberContainer.className = 'form-group';
        document.getElementById('department').parentNode.after(courtNumberContainer);
    }

    courtNumberContainer.innerHTML = `
        <label for="court-number">Mahkeme</label>
        <select id="court-number" name="court-number">
            <option value="${department}">${department}</option>
            ${Array.from({length: 50}, (_, i) => i + 1).map(num => 
                `<option value="${num}.${department}">${num}.${department}</option>`
            ).join('')}
        </select>
    `;
}

// Form submit işlemini güncelle
document.querySelector('.add-file-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const courtNumber = document.getElementById('court-number');
    const department = document.getElementById('department');
    
    // Seçilen mahkeme numarasını department değeri olarak kullan
    const finalDepartment = courtNumber && courtNumber.value ? courtNumber.value : department.value;
    
    const formData = {
        'file-type': document.getElementById('file-type').value,
        'courthouse': document.getElementById('courthouse').value,
        'department': finalDepartment,
        'year': document.getElementById('year').value,
        'case-number': document.getElementById('case-number').value,
        'client-name': document.getElementById('client-name').value,
        'open-date': document.getElementById('open-date').value
    };

    // Tüm alanların dolu olduğunu kontrol et
    for (let key in formData) {
        if (!formData[key]) {
            alert('Lütfen tüm alanları doldurunuz.');
            return;
        }
    }

    // Form verilerini POST isteği ile gönder
    fetch('/dosya_ekle', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
    })
    .then(response => {
        if (response.ok) {
            window.location.href = '/dosya_sorgula';
        } else {
            return response.json().then(data => {
                throw new Error(data.message || 'Bir hata oluştu');
            });
        }
    })
    .catch(error => {
        console.error('Hata:', error);
        alert('Dosya eklenirken bir hata oluştu: ' + error.message);
    });
});

// Sayfa yüklendiğinde adliye listesini doldur
document.addEventListener('DOMContentLoaded', populateCourthouses);
</script>

<style>
.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #2c3e50;
}

.form-group select,
.form-group input {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    font-size: 0.95rem;
}

.form-group select:focus,
.form-group input:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
}

#court-number-container {
    margin-top: 15px;
}

#court-number-container select {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    font-size: 0.95rem;
}

#court-number-container select:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
}

#court-number-container label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #2c3e50;
}
</style>
{% endblock %}