{% extends "layout.html" %}

{% block title %}Dosya Sorgula{% endblock %}

{% block content %}
<header>
    <div class="header-left">
        <h1>Dosya Sorgula</h1>
    </div>
</header>

<div class="inbox">
    <form method="POST" class="search-form">
        <div class="form-grid">
            <div class="input-group">
                <label for="file-type">Dosya Türü</label>
                <select id="file-type" name="file-type">
                    <option value="">Tümü</option>
                    <option value="ceza">Ceza</option>
                    <option value="hukuk">Hukuk</option>
                    <option value="icra">İcra</option>
                    <option value="savcilik">Savcılık</option>
                    <option value="aihm">AİHM</option>
                    <option value="aym">AYM</option>
                </select>
            </div>
            <div class="input-group">
                <label for="year">Yıl</label>
                <input type="number" id="year" name="year">
            </div>
            <div class="input-group">
                <label for="case-number">Esas No</label>
                <input type="text" id="case-number" name="case-number">
            </div>
            <div class="input-group">
                <label for="client-name">Müvekkil Adı</label>
                <input type="text" id="client-name" name="client-name">
            </div>
        </div>
        <div style="text-align: right; margin-top: 15px;">
            <button type="submit" class="btn">Ara</button>
        </div>
    </form>
</div>

<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>Dosya Türü</th>
                <th>Yıl</th>
                <th>Esas No</th>
                <th>Müvekkil Adı</th>
                <th>İşlemler</th>
            </tr>
        </thead>
        <tbody>
            {% for case_file in case_files %}
            <tr>
                <td>{{ case_file.file_type }}</td>
                <td>{{ case_file.year }}</td>
                <td>{{ case_file.case_number }}</td>
                <td>{{ case_file.client_name }}</td>
                <td>
                    <div class="action-buttons">
                        <button class="detail-btn" onclick="showDetails({{ case_file.id }})">Detay</button>
                        <button class="edit-btn" onclick="editCase({{ case_file.id }})"><i class="material-icons">edit</i></button>
                        <button class="delete-btn" onclick="deleteCase({{ case_file.id }})">Sil</button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
function toggleDropdown(id) {
    var element = document.getElementById(id);
    if (element.style.display === "none" || element.style.display === "") {
        element.style.display = "block";
    } else {
        element.style.display = "none";
    }
}

function showDetails(caseId) {
    // Detayları gösterme işlemi
    fetch(`/case_details/${caseId}`)
        .then(response => response.json())
        .then(data => {
            alert('Dosya Detayları:\n' + JSON.stringify(data, null, 2));
        });
}

function editCase(caseId) {
    // Düzenleme işlemi
    const newFileType = prompt('Yeni Dosya Türü:', '');
    const newYear = prompt('Yeni Yıl:', '');
    const newCaseNumber = prompt('Yeni Esas No:', '');
    const newClientName = prompt('Yeni Müvekkil Adı:', '');

    fetch(`/edit_case/${caseId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            file_type: newFileType,
            year: newYear,
            case_number: newCaseNumber,
            client_name: newClientName
        })
    }).then(response => response.json())
      .then(data => {
          if (data.success) {
              alert('Dosya güncellendi!');
              location.reload();
          } else {
              alert('Güncelleme başarısız!');
          }
      });
}

function deleteCase(caseId) {
    // Silme işlemi
    if (confirm('Bu dosyayı silmek istediğinizden emin misiniz?')) {
        fetch(`/delete_case/${caseId}`, {
            method: 'POST'
        }).then(response => response.json())
          .then(data => {
              if (data.success) {
                  alert('Dosya silindi!');
                  location.reload();
              } else {
                  alert('Silme işlemi başarısız!');
              }
          });
    }
}
</script>
{% endblock %}